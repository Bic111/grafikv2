openapi: 3.1.0
info:
  title: WorkSchedule PL API – Plan 2 Extensions
  version: 2.0.0-draft
  description: >-
    Rozszerzone kontrakty API dla Plan 2, obejmujące zarządzanie świętami,
    parametrami generatora, walidację, generowanie grafiku oraz raporty.
servers:
  - url: http://localhost:5000
paths:
  /api/swieta:
    get:
      summary: Lista świąt
      responses:
        '200':
          description: Kolekcja świąt
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Holiday'
    post:
      summary: Dodaj święto
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HolidayInput'
      responses:
        '201':
          description: Utworzone święto
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Holiday'
  /api/swieta/{holidayId}:
    parameters:
      - $ref: '#/components/parameters/HolidayId'
    put:
      summary: Aktualizuj święto
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HolidayInput'
      responses:
        '200':
          description: Zaktualizowane święto
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Holiday'
    delete:
      summary: Usuń święto
      responses:
        '204':
          description: Usunięto
  /api/parametry-generatora:
    get:
      summary: Lista profili parametrów generatora
      responses:
        '200':
          description: Kolekcja profili
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GeneratorParameter'
    post:
      summary: Dodaj profil parametrów
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GeneratorParameterInput'
      responses:
        '201':
          description: Utworzony profil
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GeneratorParameter'
  /api/parametry-generatora/{parameterId}:
    parameters:
      - $ref: '#/components/parameters/ParameterId'
    put:
      summary: Aktualizuj profil parametrów
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GeneratorParameterInput'
      responses:
        '200':
          description: Zaktualizowany profil
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GeneratorParameter'
    delete:
      summary: Usuń profil parametrów
      responses:
        '204':
          description: Usunięto
  /api/grafiki/generuj:
    post:
      summary: Generuj miesięczny grafik
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ScheduleGenerationRequest'
      responses:
        '202':
          description: Wygenerowany grafik wraz z diagnostyką
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScheduleScenario'
  /api/grafiki/{scenarioId}:
    parameters:
      - $ref: '#/components/parameters/ScenarioId'
    put:
      summary: Zapisz zmodyfikowany grafik
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ScheduleUpdateRequest'
      responses:
        '200':
          description: Zaktualizowany grafik
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScheduleScenario'
  /api/raporty:
    get:
      summary: Pobierz raporty za okres
      parameters:
        - name: month
          in: query
          required: true
          schema:
            type: string
            pattern: '^\d{4}-\d{2}$'
        - name: format
          in: query
          schema:
            type: string
            enum: [json, csv, pdf]
      responses:
        '200':
          description: Raporty i metryki
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReportResponse'
  /api/walidacja:
    post:
      summary: Waliduj scenariusz grafiku
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ScheduleScenario'
      responses:
        '200':
          description: Lista naruszeń i status walidacji
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationSummary'
components:
  parameters:
    HolidayId:
      name: holidayId
      in: path
      required: true
      schema:
        type: string
    ParameterId:
      name: parameterId
      in: path
      required: true
      schema:
        type: string
    ScenarioId:
      name: scenarioId
      in: path
      required: true
      schema:
        type: string
  schemas:
    Holiday:
      type: object
      required: [id, date, name]
      properties:
        id:
          type: string
        date:
          type: string
          format: date
        name:
          type: string
        coverageOverrides:
          type: object
          additionalProperties:
            type: object
        storeClosed:
          type: boolean
    HolidayInput:
      type: object
      required: [date, name]
      properties:
        date:
          type: string
          format: date
        name:
          type: string
        coverageOverrides:
          type: object
        storeClosed:
          type: boolean
    GeneratorParameter:
      type: object
      required: [id, scenarioType, weights]
      properties:
        id:
          type: string
        scenarioType:
          type: string
        weights:
          type: object
        maxConsecutiveNights:
          type: integer
        minRestHoursOverride:
          type: integer
        lastUpdatedBy:
          type: string
    GeneratorParameterInput:
      type: object
      required: [scenarioType, weights]
      properties:
        scenarioType:
          type: string
        weights:
          type: object
        maxConsecutiveNights:
          type: integer
        minRestHoursOverride:
          type: integer
    ScheduleGenerationRequest:
      type: object
      required: [month, generatorType]
      properties:
        month:
          type: string
          pattern: '^\d{4}-\d{2}$'
        generatorType:
          type: string
          enum: [heuristic, ortools]
        parameterProfile:
          type: string
        regenerate:
          type: boolean
        includeDiagnostics:
          type: boolean
    ScheduleScenario:
      type: object
      required: [id, month, generatorType, status, assignments]
      properties:
        id:
          type: string
        month:
          type: string
          pattern: '^\d{4}-\d{2}$'
        generatorType:
          type: string
        status:
          type: string
        runtimeMs:
          type: integer
        penaltyScore:
          type: number
        diagnostics:
          type: object
        assignments:
          type: array
          items:
            $ref: '#/components/schemas/ScheduleEntry'
        validation:
          $ref: '#/components/schemas/ValidationSummary'
    ScheduleEntry:
      type: object
      required: [date, shiftId, employeeId]
      properties:
        date:
          type: string
          format: date
        shiftId:
          type: string
        employeeId:
          type: string
        roleId:
          type: string
    ScheduleUpdateRequest:
      type: object
      required: [assignments]
      properties:
        assignments:
          type: array
          items:
            $ref: '#/components/schemas/ScheduleEntry'
        markApproved:
          type: boolean
    ReportResponse:
      type: object
      properties:
        metrics:
          type: object
        absences:
          type: array
          items:
            type: object
        exports:
          type: array
          items:
            type: object
    ValidationSummary:
      type: object
      properties:
        status:
          type: string
          enum: [clear, warnings, blocking]
        issues:
          type: array
          items:
            $ref: '#/components/schemas/ValidationIssue'
    ValidationIssue:
      type: object
      properties:
        severity:
          type: string
          enum: [blocking, warning]
        ruleCode:
          type: string
        message:
          type: string
        affectedAssignments:
          type: array
          items:
            $ref: '#/components/schemas/ScheduleEntry'
